<!DOCTYPE html>
<html>
<head>
    <title>Analyze Sample</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
	//tmp, load static dataset
	<script src="data.js" ></script>
</head></head>
<body>

<script type="text/javascript">

 function processImage() {
        // **********************************************
        // *** Update or verify the following values. ***
        // **********************************************

        var subscriptionKey = "b22d69d2311b43749c5161e036a3079c";
        var endpoint = "https://testblabla.cognitiveservices.azure.com/";
        
        var uriBase = endpoint + "vision/v3.1/analyze";
	//retrieve data from discomap
		var discomap = "https://discodata.eea.europa.eu/sql?query=Select%20%5BCO2Emission%5D.%5Blatest%5D.%5Bco2cars%5D.%5BMh%5D%2C%20year%2C%20avg(cast(%5BCO2Emission%5D.%5Blatest%5D.%5Bco2cars%5D.%5BEwltp%20(g%2Fkm)%5Das%20int))%20as%20avgEwltp%20from%20%5BCO2Emission%5D.%5Blatest%5D.%5Bco2cars%5D%20%0AWHERE%20%20%5BCO2Emission%5D.%5Blatest%5D.%5Bco2cars%5D.%5BMh%5D%20like%20%27" + data.brands[0].name +"%25%27%0AGROUP%20BY%20%5BCO2Emission%5D.%5Blatest%5D.%5Bco2cars%5D.%5BMh%5D%2C%20year%0AHAVING%20avg(cast(%5BCO2Emission%5D.%5Blatest%5D.%5Bco2cars%5D.%5BEwltp%20(g%2Fkm)%5Das%20int))%20IS%20NOT%20NULL%0A&nrOfHits=100&?callback=?"
		fetch(discomap)
		.then(res => res.json())
		.then(discomapResult =>
		console.log(discomapResult.results))

	 
        // Request parameters.
        var params = {
            "visualFeatures": "Categories,Description,objects,brands",
            "details": "",
            "language": "en",
        };

        // Display the image.
        var sourceImageUrl = "https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Ftse1.mm.bing.net%2Fth%3Fid%3DOIP.VPPB6JDxTrIKom_O8uowLgHaHa%26pid%3DApi&f=1";
        document.querySelector("#sourceImage").src = sourceImageUrl;

        // Make the REST API call.
        $.ajax({
            url: uriBase + "?" + $.param(params),

            // Request headers.
            beforeSend: function(xhrObj){
                xhrObj.setRequestHeader("Content-Type","application/json");
                xhrObj.setRequestHeader(
                    "Ocp-Apim-Subscription-Key", subscriptionKey);
            },

            type: "POST",

            // Request body.
            //data: '{"url": ' + '"' + sourceImageUrl + '"}',
			})

        .done(function(data) {
            // Show formatted JSON on webpage.
            $("#responseTextArea").val(JSON.stringify(data, null, 2));
			console.log(JSON.parse(data).brands.name);
        })

        .fail(function(jqXHR, textStatus, errorThrown) {
            // Display error message.
            var errorString = (errorThrown === "") ? "Error. " :
                errorThrown + " (" + jqXHR.status + "): ";
            errorString += (jqXHR.responseText === "") ? "" :
                jQuery.parseJSON(jqXHR.responseText).message;
            alert(errorString);
        });
    };
</script>

<h1>Analyze image:</h1>
Enter the URL to an image, then click the <strong>Analyze image</strong> button.
<br><br>
Image to analyze:
<input type="text" name="inputImage" id="inputImage"
    value="https://upload.wikimedia.org/wikipedia/commons/3/3c/Shaki_waterfall.jpg" />
<button onclick="processImage()">Analyze image</button>
<br><br>
<div id="wrapper" style="width:1020px; display:table;">
    <div id="jsonOutput" style="width:600px; display:table-cell;">
        Response:
        <br><br>
        <textarea id="responseTextArea" class="UIInput"
                  style="width:580px; height:400px;"></textarea>
    </div>
    <div id="imageDiv" style="width:420px; display:table-cell;">
        Source image:
        <br><br>
        <img id="sourceImage" width="400" />
    </div>
</div>
</body>
</html>
